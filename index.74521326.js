var t=function(t){if(0===t.length)return null;let e=Math.floor(Math.random()*t.length);return t[e]},e=function(t,e){let s=t.filter(t=>0!==t),l=t.length-s.length;for(;l>0;)e?s.push(0):s.unshift(0),l--;return s},s=function(t){return t[0].map((e,s)=>t.map(t=>t[s]))};const l=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.state=t.map(t=>t.slice()),this.status="idle",this.score=0}move(e,s){"playing"===this.getStatus()&&this[e](s)&&this.setCell(t(this.getFreeCells()))}moveLeft(){this.move("collapseRow",!0)}moveRight(){this.move("collapseRow",!1)}moveUp(){this.move("collapseColumn",!0)}moveDown(){this.move("collapseColumn",!1)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}getFreeCells(){let t=this.getState(),e=[];for(let s of t)s.forEach((l,i)=>{0===l&&e.push([t.indexOf(s),i])});return e}setCell(t){let e;if(!t)return;let[s,l]=t;e=.9>Math.random()?2:4,this.state[s][l]=e}updateField(t){let e=this.getState();for(let s of t.children){let l=[...t.children].indexOf(s);for(let t of s.cells){let i=[...s.cells].indexOf(t),r=e[l][i];t.textContent=r||"",t.classList=`field-cell field-cell--${r||""}`}}}collapse(t,e){let s=[],l=0;if(e)for(let e=0;e<t.length;e++)t[e]===t[e+1]?(s.push(2*t[e]),l+=2*t[e],e++):s.push(t[e]);else for(let e=t.length-1;e>=0;e--)t[e]===t[e-1]?(s.unshift(2*t[e]),l+=2*t[e],e--):s.unshift(t[e]);for(;s.length<t.length;)e?s.push(0):s.unshift(0);return this.score+=l,s}collapseRow(t=!0){let s=this.getState(),l=[];for(let i of s){let s=e(i,t),r=this.collapse(s,t);l.push(r)}return JSON.stringify(s)!==JSON.stringify(l)&&(this.state=l,!0)}collapseColumn(t=!0){let l=s(this.getState()),i=[];for(let s of l){let l=e(s,t),r=this.collapse(l,t);i.push(r)}return JSON.stringify(l)!==JSON.stringify(i)&&(this.state=s(i),!0)}isMovesPossible(){let t=this.getState(),e=s(this.getState());if(this.getFreeCells().length)return!0;for(let s=0;s<t.length;s++){let l=t[s],i=e[s],r=i.some((t,e)=>t===i[e+1]);if(l.some((t,e)=>t===l[e+1])||r)return!0}return!1}isWinning(){return this.getState().some(t=>t.some(t=>2048===t))}start(){this.status="playing",this.setCell(t(this.getFreeCells())),this.setCell(t(this.getFreeCells()))}restart(){this.status="idle",this.score=0,this.state=this.initialState.map(t=>t.slice())}}([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),i=document.querySelector("body"),r=i.querySelector(".game-field tbody"),o=document.querySelector("button.start"),n=document.querySelector(".message-start"),a=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),u=document.querySelector(".game-score");i.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":l.moveLeft(),l.updateField(r);break;case"ArrowRight":l.moveRight(),l.updateField(r);break;case"ArrowUp":l.moveUp(),l.updateField(r);break;case"ArrowDown":l.moveDown(),l.updateField(r)}u.textContent=l.score,l.isMovesPossible()||(h.classList.remove("hidden"),l.status="lose"),l.isWinning()&&(a.classList.remove("hidden"),l.status="win")}),o.addEventListener("click",t=>{t.target.classList.contains("restart")?(l.restart(),t.target.classList="button start",t.target.textContent="Start",h.classList.add("hidden"),a.classList.add("hidden")):(l.start(),t.target.classList="button restart",t.target.textContent="Restart"),n.classList.toggle("hidden"),u.textContent=l.score,l.updateField(r)});
//# sourceMappingURL=index.74521326.js.map
